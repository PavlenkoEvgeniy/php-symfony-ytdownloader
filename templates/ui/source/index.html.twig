{% extends 'base.html.twig' %}

{% block title %}YoutubeDownload :: Downloads
{% endblock %}

{% block body %}
    {% for message in app.flashes('success') %}
        <div class="alert alert-success mt-1" role="alert">
            {{ message }}
        </div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger mt-1" role="alert">
            {{ message }}
        </div>
    {% endfor %}
    {% for message in app.flashes('warning') %}
        <div class="alert alert-warning mt-1" role="alert">
            {{ message }}
        </div>
    {% endfor %}
    <div class="d-flex justify-content-between mt-4 mb-2">
        <a class="btn btn-outline-success" href="{{ path('ui_download_index') }}">+ Add new download</a>
        {% if pagination is not empty %}
            {{ include('ui/source/_delete_all_form.html.twig') }}
        {% endif %}
    </div>
    <div class="text-center mt-4">
        <span class="fw-bold">In queue: {{ totalPending }}</span> |
        <span class="fw-bold">In progress: {{ totalInProgress }}</span>
    </div>
    {% if pagination is not empty %}
        <div class="col-sm-3 col-md-2 col-lg-1">
            <div>
                <label for="sort_by_select"></label>
                <select id="sort_by_select"
                        onchange="location.search.includes('order') ? location.search = location.search.replace(/order=\w+/, this.value) : location.search += '&' + this.value"
                        class="form-select form-select-sm">
                    <option {{ (order=='asc' ) ? 'selected' : '' }} value="order=asc">Date &#8595;</option>
                    <option {{ (order=='desc' ) ? 'selected' : '' }} value="order=desc">Date &#8593;</option>
                </select>
            </div>
        </div>
    {% endif %}
    <div class="table-responsive-lg">
        <table class="table table-sm">
            <thead class="text-center">
            <tr>
                <th>No</th>
                <th>Filename</th>
                <th>Size</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for source in pagination %}
                <tr>
                    <td>{{ startingNumber + loop.index0 }}</td>
                    <td>{{ source.filename }}</td>
                    <td class="text-center">{{ source.size|readable_filesize(2) }}</td>
                    <td class="d-grid gap-2 text-center">
                        <div>
                            <a class="btn btn-outline-success" href="{{ path('ui_source_download', {'id': source.id}) }}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m4-5l5 5 5-5m-5 5V3"/>
                                </svg>
                            </a>
                        </div>
                        <div>
                            <a class="btn btn-outline-secondary" href="{{ path('ui_source_show', {'id': source.id}) }}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </a>
                        </div>
                        {% if is_granted('ROLE_ADMIN') %}
                            <div>
                                <a class="btn btn-outline-warning" href="{{ path('ui_source_edit', {'id': source.id}) }}">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </a>
                            </div>
                        {% endif %}
                        {{ include('ui/source/_delete_form.html.twig') }}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td class="text-center" colspan="8">No records found...</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div>
        {{ knp_pagination_render(pagination) }}
    </div>
{% endblock %}
